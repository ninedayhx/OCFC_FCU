/* USER CODE BEGIN Header */
/**
  ******************************************************************************
  * @file           : main.h
  * @brief          : Header for main.c file.
  *                   This file contains the common defines of the application.
  ******************************************************************************
  * @attention
  *
  * Copyright (c) 2023 STMicroelectronics.
  * All rights reserved.
  *
  * This software is licensed under terms that can be found in the LICENSE file
  * in the root directory of this software component.
  * If no LICENSE file comes with this software, it is provided AS-IS.
  *
  ******************************************************************************
  */
/* USER CODE END Header */

/* Define to prevent recursive inclusion -------------------------------------*/
#ifndef __MAIN_H
#define __MAIN_H

#ifdef __cplusplus
extern "C" {
#endif

/* Includes ------------------------------------------------------------------*/
#include "stm32g4xx_hal.h"

/* Private includes ----------------------------------------------------------*/
/* USER CODE BEGIN Includes */
#include <stdbool.h>
/* USER CODE END Includes */

/* Exported types ------------------------------------------------------------*/
/* USER CODE BEGIN ET */
typedef enum {
    STATE_LoLo,
    STATE_Lo,
	STATE_Normal,
	STATE_High,
	STATE_HiHi
} ValState_t;
typedef struct {
    float LoLo_Val;		//æä½
    float Lo_Val;		//è¿‡ä½
    float High_Val;		//è¿‡é«˜
    float HiHi_Val;		//æé«˜
    float Current_Val;	//å½“å‰ï¿???
    ValState_t Status;	//çŠ¶å‰çŠ¶ï¿½?ï¿½æšä¸¾ç±»å‹å˜ï¿???
} Parameter_t;
typedef struct {
	/**
	 * DMAè·å–æ•°ç»„å€¼ä¸é€šé“å¯¹åº”å…³ç³»
	 * adc1_0->AD1_IN3	->PA2	->Power_Voltage; 						//FCUè¾“å…¥ç”µå‹(å•ä½V)
	 * adc1_1->AD1_IN4	->PA3	->External_Hydrogen_Concentration;	//å †å¤–æ°¢æµ“
	 * adc1_2->AD1_IN5	->PC4	->Hydrogen_Cylinder_Pressure;			//æ°¢æ°”ç“¶å‹
	 * adc1_3->AD1_IN11	->PB12	->FC_Internal_Temperature;				//å †å†…æ¸©åº¦	(å•ä½æ‘„æ°ï¿???)
	 * adc1_4->AD1_IN12	->PB1	->FC_External_Temperature;				//å †å¤–æ¸©åº¦	(å•ä½æ‘„æ°ï¿???)
	 * adc2_0->AD2_IN1	->PA0	->Shunt_A_Current;						//åˆ†æµå™¨Aç”µæµ(å•ä½A)
	 * adc2_1->AD2_IN2	->PA1	->Shunt_A_Voltage;						//åˆ†æµå™¨Aç”µå‹(å•ä½V)
	 * adc2_2->AD2_IN5	->PC4	->Shunt_B_Current;						//åˆ†æµå™¨Bç”µæµ(å•ä½A)
	 * adc2_3->AD2_IN12	->PB2	->Shunt_B_Voltage;						//åˆ†æµå™¨Bç”µå‹(å•ä½V)
	 */
	uint16_t adc1_values[5];							//adc1åŸå§‹ å€?
	uint16_t adc2_values[4];							//adc2åŸå§‹ å€?
	Parameter_t Power_Voltage; 						//FCUè¾“å…¥ç”µå‹(å•ä½V)
	Parameter_t Shunt_A_Voltage;						//åˆ†æµå™¨Aç”µå‹(å•ä½V)
	Parameter_t Shunt_A_Current;						//åˆ†æµå™¨Aç”µæµ(å•ä½A)
	Parameter_t Shunt_A_Power;						//*åˆ†æµå™¨Aç¬æ—¶åŠŸç‡(å•ä½kW)
	Parameter_t Shunt_A_Total_Energy;				//*åˆ†æµå™¨Aç´¯è®¡ç”µèƒ½(å•ä½kWh)
	Parameter_t Shunt_B_Voltage;						//åˆ†æµå™¨Bç”µå‹(å•ä½V)
	Parameter_t Shunt_B_Current;						//åˆ†æµå™¨Bç”µæµ(å•ä½A)
	Parameter_t Shunt_B_Power;						//*åˆ†æµå™¨Bç¬æ—¶åŠŸç‡(å•ä½kW)
	Parameter_t Shunt_B_Total_Energy;				//*åˆ†æµå™¨Bç´¯è®¡ç”µèƒ½(å•ä½kWh)
	Parameter_t FC_Internal_Temperature;			//å †å†…æ¸©åº¦	(å•ä½æ‘„æ°ï¿???)
	Parameter_t FC_External_Temperature;			//å †å¤–æ¸©åº¦	(å•ä½æ‘„æ°ï¿???)
	Parameter_t Hydrogen_Cylinder_Pressure;		//æ°¢æ°”ç“¶å‹
	Parameter_t External_Hydrogen_Concentration;	//å †å¤–æ°¢æµ“
	float Shooting_Flow;		//ç¬æ—¶æµé‡
	float Integrated_Flow;	//ç´¯è®¡æµé‡

} AnalogInputs_TypeDef;
typedef struct {
	uint8_t Expected_FC_Fan_Speed;					//ç›®æ ‡ï¿??? FCä¸»é£æ‰‡è½¬ï¿??? PWM å ç©ºï¿??? 0-100%
	bool Expected_FC_Fan_Enable;						//ç›®æ ‡ï¿??? FCä¸»é£æ‰‡ä½¿ï¿???
	bool Expected_DCDC_Enable;							//ç›®æ ‡ï¿??? DCDCä½¿èƒ½
	bool Expected_Heatsink_Fan_Enable;				//ç›®æ ‡ï¿??? FCUæ•£çƒ­é£æ‰‡ä½¿èƒ½
	bool Expected_Hydrogen_Inlet_Valve_Enable;		//ç›®æ ‡ï¿??? æ°¢æ°”è¿›æ°”ï¿???ä½¿èƒ½
	bool Expected_Hydrogen_Exhaust_Valve_Enable;	//ç›®æ ‡ï¿??? æ°¢æ°”æ’æ°”ï¿???ä½¿èƒ½
	bool Expected_Contactor_Fc_Enable;				//ç›®æ ‡ï¿??? ç‡ƒæ–™ç”µæ± æ¥è§¦å™¨Aä½¿èƒ½
  	bool Expected_Contactor_Load_Enable;				//ç›®æ ‡ï¿??? ç»ˆç«¯è´Ÿè½½æ¥è§¦å™¨Bä½¿èƒ½
} SysControl_TypeDef;

typedef enum {
	DEVICE_STOPPED, 	//åœæœº
    DEVICE_RUNNING, 	//æ­£å¸¸è¿è¡Œ
    DEVICE_STANDBY, 	//èŠ‚èƒ½å¾…æœº
    DEVICE_ERROR,		//å¼‚å¸¸
    DEVICE_FAULT		//æ•…éšœ
} DeviceStatus_t;

typedef struct {
    bool device_paused;     //è®¾å¤‡æ˜¯å¦å·²æš‚å?
    bool device_started;    //è®¾å¤‡æ˜¯å¦å·²å¯åŠ?
    bool device_stopped;    //è®¾å¤‡æ˜¯å¦å·²åœæ­?
    bool device_error;      //è®¾å¤‡æ˜¯å¦å‡ºç°é”™è¯¯
    bool device_fault;      //è®¾å¤‡æ˜¯å¦æ•…éšœ
} DeviceFlags_t;

typedef struct {
	//ç”¨äºå‚¨å­˜PCA9555å½“å‰ IO çŠ¶æ?å’Œç›®æ ‡ IO çŠ¶æ??
    uint16_t pca9555_current_state;	//å½“å‰
    uint16_t pca9555_expected_state;	//æœŸæœ›
} PCA9555_IO_Status_t;

/* USER CODE END ET */

/* Exported constants --------------------------------------------------------*/
/* USER CODE BEGIN EC */

/* USER CODE END EC */

/* Exported macro ------------------------------------------------------------*/
/* USER CODE BEGIN EM */

/* USER CODE END EM */

/* Exported functions prototypes ---------------------------------------------*/
void Error_Handler(void);

/* USER CODE BEGIN EFP */

/* USER CODE END EFP */

/* Private defines -----------------------------------------------------------*/
#define W25Q64_CS_Pin GPIO_PIN_4
#define W25Q64_CS_GPIO_Port GPIOA
#define WS2812_800KHz_Pin GPIO_PIN_6
#define WS2812_800KHz_GPIO_Port GPIOC
#define BUZZER_2700Hz_Pin GPIO_PIN_15
#define BUZZER_2700Hz_GPIO_Port GPIOA
#define PCA9555_INT_Pin GPIO_PIN_9
#define PCA9555_INT_GPIO_Port GPIOB

/* USER CODE BEGIN Private defines */
#define CAN_ID 0x456			// å®šä¹‰CANå¸§çš„æ ‡è¯†ç¬?
#define SAMPLING_INTERVAL (300) //ADCé‡‡æ ·é—´éš”
#define DELAY_TIME (1000)

/*----------------------æ¨¡æ‹Ÿå€¼é‡‡æ ·å‚æ•°è®¾ç½?----------------------*/
#define NTC_B           (3950.0)     //æ¸©åº¦ç³»æ•°
#define NTC_TN          (298.15)     //é¢å®šæ¸©åº¦(ç»å¯¹æ¸©åº¦åŠ å¸¸ï¿???:273.15+25)
#define NTC_RN          (10000.0)   // çƒ­æ•ç”µé˜»é˜»å?? 25 æ‘„æ°åº¦æ—¶çš„é˜»ï¿???(å•ä½æ¬§å§†)
#define NTC_R1          (10000.0)   // åˆ†å‹ç”µé˜»é˜»å??
#define NTC_BaseVol     (3.29)        //ADåŸºå‡†ç”µå‹
/*-------------------------ç³»ç»Ÿå‚æ•°è®¾ç½®------------------------*/
//#define DEFAULT_SYS_TWOFC 			//åŒå †å®šä¹‰
#define DEFAULT_SYS_STATUS DEVICE_STOPPED			//ç³»ç»Ÿé»˜è®¤çŠ¶æ??
#define SYS_MAX_POWER		(0.7)					//æ•´ä¸ªç³»ç»Ÿæœ?å¤§è¾“å‡ºKW
#define FC_LOLO_V			(55*0.55-3) 			//ç”µå †çº§é™æœ?ä½ç”µå? å•ç‰‡æˆªæ­¢ç”µå‹0.55Vï¼ˆä½äºä¸å¯é?†æŸåï¼Œï¼‰æœ€å¤§ç”µå? 1V
#define FC_HIHI_TEMP		(55)					//ç”µå †çº§é™æ¸©åº¦
#define FC_NORMAL_TEMP		(46)					//ç”µå †ç†æƒ³æ¸©åº¦
#define FC_EXHAUST_PERIED   (7500)					//æ’æ°”å‘¨æœŸ ms
#define FC_EXHAUST_TIME     (200)					//æ’æ°”æ—¶é•¿ ms

#ifdef DEFAULT_SYS_TWOFC   //åŒå †ä½¿èƒ½
#define A_FC_LOLO_V	FC_LOLO_V
#define B_FC_LOLO_V	(45.1-2)
#endif

#define RS485_FLOWMETER								//å¦‚æœæ²¡æœ‰æµé‡è®¡æ³¨é‡Šè¿™ä¸?æ?

#define DISPLAY_ICON_R (0)
#define DISPLAY_ICON_Y (1)
#define DISPLAY_ICON_G (2)

//#define USE_DEBUG_PCA9555
//#define USE_DEBUG_ANALOG

/* USER CODE END Private defines */

#ifdef __cplusplus
}
#endif

#endif /* __MAIN_H */
